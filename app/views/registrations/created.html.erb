<% content_for :title, "User created" %>
<div class="card mx-auto max-w-lg">
  <p class="card-title">Admin</p>
  <h1 class="section-title">User created</h1>
  <p class="muted">Copy these details now. The temporary password will not be shown again.</p>

  <div class="mt-6 space-y-3 rounded-2xl border border-black/10 bg-slate-50 px-4 py-3 text-center text-sm">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-500">Email</p>
      <div class="mt-1 flex items-center justify-center gap-2">
        <span class="font-medium text-slate-900"><%= @user.email %></span>
        <button
          type="button"
          class="btn-secondary h-8 w-8"
          style="padding: 0;"
          data-copy-value="<%= @user.email %>"
          aria-label="Copy email"
          title="Copy email"
        >
          <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="9" y="9" width="13" height="13" rx="2"></rect>
            <rect x="3" y="3" width="13" height="13" rx="2"></rect>
          </svg>
        </button>
      </div>
    </div>
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-500">Temporary password</p>
      <div class="mt-1 flex items-center justify-center gap-2">
        <span class="font-medium text-slate-900"><%= @temporary_password %></span>
        <button
          type="button"
          class="btn-secondary h-8 w-8"
          style="padding: 0;"
          data-copy-value="<%= @temporary_password %>"
          aria-label="Copy temporary password"
          title="Copy temporary password"
        >
          <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="9" y="9" width="13" height="13" rx="2"></rect>
            <rect x="3" y="3" width="13" height="13" rx="2"></rect>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <p class="muted mt-4">Ask them to change it after logging in.</p>

  <div class="mt-6 flex flex-wrap gap-3">
    <%= link_to "Create another user", sign_up_path, class: "btn" %>
    <%= link_to "Back to app", root_path, class: "btn-ghost" %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll("[data-copy-value]");
    if (!buttons.length) return;

    const fallbackCopy = (text) => {
      const textarea = document.createElement("textarea");
      textarea.value = text;
      textarea.setAttribute("readonly", "");
      textarea.style.position = "absolute";
      textarea.style.left = "-9999px";
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand("copy");
      document.body.removeChild(textarea);
    };

    buttons.forEach((button) => {
      const originalLabel = button.getAttribute("aria-label") || "Copy";

      button.addEventListener("click", async () => {
        const text = button.dataset.copyValue;

        try {
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(text);
          } else {
            fallbackCopy(text);
          }
          button.setAttribute("aria-label", "Copied");
          button.setAttribute("title", "Copied");
        } catch (_error) {
          button.setAttribute("aria-label", "Copy failed");
          button.setAttribute("title", "Copy failed");
        }

        window.setTimeout(() => {
          button.setAttribute("aria-label", originalLabel);
          button.setAttribute("title", originalLabel);
        }, 2000);
      });
    });
  });
</script>
